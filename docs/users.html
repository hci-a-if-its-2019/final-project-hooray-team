<!doctype html>
<html class="fixed">
	<head>

		<!-- Basic -->
		<meta charset="UTF-8">

		<title>Users Management</title>
		<meta name="keywords" content="HTML5 Admin Template" />
		<meta name="description" content="Porto Admin - Responsive HTML5 Template">
		<meta name="author" content="okler.net">

		<!-- Mobile Metas -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

		<!-- Web Fonts  -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css">

		<!-- Vendor CSS -->
		<link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.css" />
		<link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.css" />
		<link rel="stylesheet" href="assets/vendor/magnific-popup/magnific-popup.css" />
		<link rel="stylesheet" href="assets/vendor/bootstrap-datepicker/css/datepicker3.css" />
		<link rel="stylesheet" href="assets/vendor/bootstrap-multiselect/bootstrap-multiselect.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

		<!-- Theme CSS -->
		<link rel="stylesheet" href="assets/stylesheets/theme.css" />

		<!-- Skin CSS -->
		<link rel="stylesheet" href="assets/stylesheets/skins/default.css" />

		<!-- Theme Custom CSS -->
		<link rel="stylesheet" href="assets/stylesheets/theme-custom.css">

		<!-- Head Libs -->
		<script src="assets/vendor/modernizr/modernizr.js"></script>

		<style type="text/css">
			.page-header img {
				padding-top: 10px;
				padding-left: 10px;
			}
		</style>

	</head>
	<body>
		<section class="body">

			<div class="inner-wrapper">
				<!-- start: sidebar -->
				<aside id="sidebar-left" class="sidebar-left">
				
					<div class="sidebar-header">
						<div class="sidebar-title">
							Navigation
						</div>
						<div class="sidebar-toggle hidden-xs" data-toggle-class="sidebar-left-collapsed" data-target="html" data-fire-event="sidebar-left-toggle">
							<i class="fa fa-bars" aria-label="Toggle sidebar"></i>
						</div>
					</div>
				
					<div class="nano">
						<div class="nano-content">
							<nav id="menu" class="nav-main" role="navigation">
								<ul class="nav nav-main">
									<li>
										<a href="index.html">
											<i class="fa fa-home" aria-hidden="true"></i>
											<span>Home</span>
										</a>
									</li>
									<li class="nav-parent">
										<a>
											<i class="fa fa-users" aria-hidden="true"></i>
											<span>Users</span>
										</a>
										<ul class="nav nav-children">
											<li>
												<a href="users.html"><i class="fa fa-user" aria-hidden="true"></i> Users</a>
											</li>
											<li>
												<a href="groups.html"><i class="fa fa-users" aria-hidden="true"></i>Groups</a>
											</li>
											<li>
												<a><i class="fa fa-plus" aria-hidden="true"></i>Select</a>
											</li>
											<li>
												<a><i class="fa fa-rocket" aria-hidden="true"></i>Online</a>
											</li>
											<li>
												<a><i class="fa fa-upload" aria-hidden="true"></i>Import</a>
											</li>
										</ul>
									</li>
									<li class="nav-parent">
										<a>
											<i class="fa fa-copy" aria-hidden="true"></i>
											<span>Modules</span>
										</a>
										<ul class="nav nav-children">
											<li>
												<a href="modules.html"><i class="fa fa-file-text" aria-hidden="true"></i>Modules</a>
											</li>
											<li>
												<a href="questions.html"><i class="fa fa-pencil" aria-hidden="true"></i>Questions</a>
											</li>
											<li>
												<a href="question_lists.html"><i class="fa fa-list" aria-hidden="true"></i>List</a>
											</li>
											<li>
												<a><i class="fa fa-upload" aria-hidden="true"></i>Import</a>
											</li>
											<li>
												<a><i class="fa fa-file" aria-hidden="true"></i>File Manager</a>
											</li>
											<li>
												<a><i class="fa fa-certificate" aria-hidden="true"></i>SSL Certificates</a>
											</li>
										</ul>
									</li>
									<li class="nav-parent">
										<a>
											<i class="fa fa-file-text" aria-hidden="true"></i>
											<span>Tests</span>
										</a>
										<ul class="nav nav-children">
											<li>
												<a href="tests.html"><i class="fa fa-file-text-o" aria-hidden="true"></i>Tests</a>
											</li>
											<li>
												<a><i class="fa fa-plus-circle" aria-hidden="true"></i>Select</a>
											</li>
											<li>
												<a><i class="fa fa-upload" aria-hidden="true"></i>Import Answers</a>
											</li>
											<li>
												<a><i class="fa fa-search-plus" aria-hidden="true"></i>OMR Bulk Importer</a>
											</li>
											<li>
												<a><i class="fa fa-list-ol" aria-hidden="true"></i>Evaluation</a>
											</li>
											<li>
												<a><i class="fa fa-rebel" aria-hidden="true"></i>Results</a>
											</li>
											<li>
												<a><i class="fa fa-user" aria-hidden="true"></i>Users</a>
											</li>
										</ul>
									</li>
									<li>
										<a href="pengajar-dashboard.html">
											<i class="fa fa-recycle" aria-hidden="true"></i>
											<span>Backup</span>
										</a>
									</li>	
									<li>
										<a href="pengajar-dashboard.html">
											<i class="fa fa-bullhorn" aria-hidden="true"></i>
											<span>Public</span>
										</a>
									</li>			
									<li>
										<a href="pengajar-dashboard.html">
											<i class="fa fa-question-circle" aria-hidden="true"></i>
											<span>Help</span>
										</a>
									</li>			
									<li>
										<a href="pengajar-dashboard.html">
											<i class="fa fa-info-circle" aria-hidden="true"></i>
											<span>Info</span>
										</a>
									</li>
									<li>
										<a href="pengajar-dashboard.html">
											<i class="fa fa-sign-out" aria-hidden="true"></i>
											<span>Logout</span>
										</a>
									</li>
								</ul>
							</nav>
				
							</div>
						</div>
				
				</aside>
				<!-- end: sidebar -->

				<section role="main" class="content-body">
					<header class="page-header">
						<img src="img/logo_tcexam.png">
					
						<div class="right-wrapper pull-right">
							<ol class="breadcrumbs">
								<li>
									<a href="index.html">
										<i class="fa fa-home"></i>
									</a>
								</li>
								<li><span>Users</span></li>
								<li><span>Users Management</span></li>
							</ol>
						</div>
					</header>

					<!-- start: page -->
					<div class="col-lg-12">
						<section class="panel">
								<header class="panel-heading">
									<h2 class="panel-title">Users Management</h2>
								</header>
                            <form id="user-form">
								<div class="panel-body">
									<div class="row">
										<div class="col-sm-12">
											<div class="form-group">
												<label class="control-label" for="user-menu">User</label>
												<div class="col-sm-12">
													<select class="form-control input-sm mb-md" id="user-menu" required>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-6">
											<div class="form-group">
												<label class="control-label">Username  </label>
												<input type="text" id="username" class="form-control" required>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="form-group">
												<label class="control-label">Email  </label>
												<input type="email" id="email" class="form-control">
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-6">
											<div class="form-group">
												<label class="control-label">Password  </label>
												<input type="password" id="password" class="form-control" required>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="form-group">
												<label class="control-label">Confirm Password  </label>
												<input type="password" id="password-confirmation" class="form-control" required>
											</div>
										</div>
									</div>

									<div class="row">
										<div class="col-sm-6">
											<div class="form-group">
												<label class="control-label" for="group">Groups  </label>
													<select class="form-control" id="group" multiple>
													</select>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="form-group">
												<label class="control-label">OTP Key</label>
                                                <button class="btn btn-dark" id="otpkey-generate"><i class="fa fa-qrcode"></i> Generate QR</button>
												<input type="text" id="otpkey" class="form-control" disabled="">
                                                <img id="otpkey-img" alt="qrcode is not available"/>
											</div>
										</div>
									</div>
									<!--<p> <span class="required">*</span>) is required</p>-->
								</div>
								<footer class="panel-footer text-center">
									<button type="submit" class="btn btn-primary">Submit</button>
                                    <button type="reset" class="btn btn-secondary">Reset</button>
								</footer>
                            </form>
						</section>
							
					</div>
					<!-- end: page -->
				</section>
			</div>
		</section>

		<!-- Vendor -->
		<script src="assets/vendor/jquery/jquery.js"></script>
		<script src="assets/vendor/jquery-browser-mobile/jquery.browser.mobile.js"></script>
		<script src="assets/vendor/bootstrap/js/bootstrap.js"></script>
		<script src="assets/vendor/nanoscroller/nanoscroller.js"></script>
		<!--<script src="assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>-->
		<!--<script src="assets/vendor/magnific-popup/magnific-popup.js"></script>-->
		<!--<script src="assets/vendor/jquery-placeholder/jquery.placeholder.js"></script>-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

		<script src="assets/vendor/bootstrap-multiselect/bootstrap-multiselect.js"></script>
		
		<!-- Theme Base, Components and Settings -->
		<script src="assets/javascripts/theme.js"></script>
		
		<!-- Theme Custom -->
		<script src="assets/javascripts/theme.custom.js"></script>
		
		<!-- Theme Initialization Files -->
		<script src="assets/javascripts/theme.init.js"></script>

		<script src="js/apl_exam.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                baseURL = window.BASE_URL;

                var option = '<option value="0">+</option>';
                $.ajax({
                    type: 'GET',
                    url: baseURL + 'user/api/user',
                    success: function(data){
                        console.log(data);
                        for (i = 0; i < data.length; i++) {
                            option += '<option value="' + data[i].id + '">' + data[i].name + '</option>';
                        }
                        $('#user-menu').append(option);
                    },
                    error: function (e) {
                        console.log(e);
                    }
                });

                $.ajax({
                    type: 'GET',
                    url: baseURL + 'user/api/group',
                    success: function(data){
                        console.log(data);
                        let groupOption = [];
                        for (i = 0; i < data.length; i++) {
                            groupOption += '<option value="' + data[i].id + '">' + data[i].name + '</option>';
                        }
                        $('#group').append(groupOption);
                    },
                    error: function (e) {
                        console.log(e);
                    }
                })

                $('#user-menu').on('change', function () {
                    var val = $(this).val();
                    console.log('val', val);
                    if (val > 0) {
                        $.ajax({
                            type: 'GET',
                            url: baseURL + 'user/api/user/id/' + val,
                            success: function (data) {
                                console.log(data);
                                $('#username').val(data.user_name);
                                $('#email').val(data.user_email);
                                $('#level').val(data.user_level);
                                otpkey = data.user_otpKey.split(".");
                                $('#otpkey').val(otpkey[0]);
                                $('#otpkey-img').attr("src", baseURL + 'public/images/' + data.user_otpKey);
                                if (data.user_otpKey != '') $('#otpkey-generate').hide();
                                else $('#otpkey-generate').show();
                            }
                        });
                    }
                    else {
                        $('#username').val('');
                        $('#email').val('');
                        $('#level').val('');
                        $('#otpkey').val('');
                        $('#otpkey-img').attr("src", "");
                        $('#otpkey-generate').show();
                    }
                });

                $('#user-form').submit(function (event) {
                    event.preventDefault();

                    data = {
                        id: $('#user-menu').val(),
                        name: $('#username').val(),
                        password: $('#password').val(),
                        email: $('#email').val(),
                        groups: $('#group').val()
                    }
                    console.log(data);

                    if (data.id == 0) {
                        $.ajax({
                            type: 'POST',
                            url: baseURL + 'user/api/user',
                            crossOrigin: true,
                            data: JSON.stringify(data),
                            dataType: 'json',
                            success: function(data){
                                toastr.success(data.message, data.status);
                                setTimeout(function () {
                                    location.reload();
                                }, 2000);
                            },
                            error: function(e){
                                console.log(e);
                                toastr.error(data.message, data.status);

                            }
                        });
                    }
                    else {
                        toastr.warning('Update user is not yet supported!', 'Warning');
                    }
                });

                $('#otpkey-generate').click(function () {
                    user_id = $('#user-menu').val();
                    console.log(user_id);
                   $.ajax({
                       type: 'GET',
                       url: baseURL + 'user/api/user/generate/' + user_id,
                       success: function (data) {
                           toastr.success(data.message, data.status);
                           setTimeout(function() {
                               location.reload();
                               $('#user-menu').val(user_id);
                           }, 2000);
                       },
                       error: function (e) {
                           toastr.error(data.message, data.status);
                       }
                   })
                });

            });
        </script>
	</body>
</html>